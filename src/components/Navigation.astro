---
import services from '../data/services.json';
const currentPath = Astro.url.pathname;

const navLinks = [
  { label: 'Home', href: '/' },
  { label: 'About', href: '/about/' },
  { label: 'Services', href: '/services/', children: services.map(s => ({ label: s.title, href: `/services/${s.slug}/` })) },
  { label: 'Pricing & Quote', href: '/quote/' },
  { label: 'Reviews', href: '/reviews/' },
  { label: 'Blog', href: '/blog/' },
  { label: 'Contact', href: '/contact/' },
];
---
<header class="sticky top-0 z-50 bg-white/95 backdrop-blur shadow-sm">
  <div class="max-w-7xl mx-auto flex items-center justify-between px-4 py-3 lg:px-8">
    <a href="/" class="flex items-center gap-2" aria-label="ProGreen Clean home">
      <span class="text-primary font-heading font-extrabold text-2xl lg:text-3xl">ProGreen</span>
      <span class="text-accent font-heading font-bold text-2xl lg:text-3xl">Clean</span>
    </a>
    <nav class="nav hidden lg:flex items-center gap-6" aria-label="Primary navigation">
      {navLinks.map((link) => (
        <div class="relative group">
          <a href={link.href}
             class={`font-heading font-semibold text-sm tracking-wide transition-colors hover:text-primary focus:text-primary focus:outline-2 focus:outline-primary ${currentPath === link.href ? 'text-primary' : 'text-navy'}`}
             aria-current={currentPath === link.href ? 'page' : undefined}>
            {link.label}
            {link.children && <span class="material-symbols-rounded text-base align-middle ml-0.5">expand_more</span>}
          </a>
          {link.children && (
            <div class="absolute left-0 top-full pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus-within:opacity-100 group-focus-within:visible transition-all duration-200 z-50">
              <div class="bg-white rounded-xl shadow-lg border border-gray-100 py-2 min-w-[220px]">
                {link.children.map((child) => (
                  <a href={child.href} class="block px-4 py-2 text-sm text-navy hover:bg-aqua-light hover:text-primary transition-colors">
                    {child.label}
                  </a>
                ))}
              </div>
            </div>
          )}
        </div>
      ))}
    </nav>
    <div class="hidden lg:flex items-center gap-4">
      <a href="tel:01372898732" class="font-heading font-semibold text-navy text-sm hover:text-primary transition-colors">
        <span class="material-symbols-rounded align-middle mr-1 text-primary">phone</span>01372 898732
      </a>
      <a href="/quote/" class="inline-block bg-primary hover:bg-primary-dark text-white font-heading font-bold text-sm px-6 py-3 rounded-full transition-colors focus:outline-2 focus:outline-primary focus:outline-offset-2">
        Get Quote
      </a>
    </div>
    <button id="menu-toggle" class="lg:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-drawer">
      <span class="material-symbols-rounded text-3xl text-navy">menu</span>
    </button>
  </div>
</header>
<div id="mobile-backdrop" class="fixed inset-0 bg-black/50 z-60 hidden lg:hidden" aria-hidden="true"></div>
<div id="mobile-drawer" class="fixed top-[60px] right-0 w-[300px] h-[calc(100vh-60px)] bg-white z-70 transform translate-x-full transition-transform duration-300 ease-in-out overflow-y-auto lg:hidden shadow-2xl" role="dialog" aria-label="Mobile menu" aria-modal="true">
  <div class="p-6 space-y-2">
    <a href="tel:01372898732" class="flex items-center gap-2 font-heading font-semibold text-navy mb-4">
      <span class="material-symbols-rounded text-primary">phone</span>01372 898732
    </a>
    <a href="/quote/" class="block w-full text-center bg-primary hover:bg-primary-dark text-white font-heading font-bold px-6 py-3 rounded-full transition-colors mb-4">Get Quote</a>
    {navLinks.map((link) => (
      <div>
        <a href={link.href}
           class={`block py-3 px-2 font-heading font-semibold text-sm border-b border-gray-100 transition-colors hover:text-primary ${currentPath === link.href ? 'text-primary' : 'text-navy'}`}>
          {link.label}
        </a>
        {link.children && (
          <div class="mobile-submenu hidden pl-4">
            {link.children.map((child) => (
              <a href={child.href} class="block py-2 px-2 text-sm text-navy/80 hover:text-primary transition-colors">{child.label}</a>
            ))}
          </div>
        )}
      </div>
    ))}
  </div>
</div>
<script>
  const toggle = document.getElementById('menu-toggle');
  const drawer = document.getElementById('mobile-drawer');
  const backdrop = document.getElementById('mobile-backdrop');
  function openMenu() {
    drawer?.classList.remove('translate-x-full');
    backdrop?.classList.remove('hidden');
    toggle?.setAttribute('aria-expanded', 'true');
    document.body.style.overflow = 'hidden';
  }
  function closeMenu() {
    drawer?.classList.add('translate-x-full');
    backdrop?.classList.add('hidden');
    toggle?.setAttribute('aria-expanded', 'false');
    document.body.style.overflow = '';
    toggle?.focus();
  }
  toggle?.addEventListener('click', () => {
    const expanded = toggle.getAttribute('aria-expanded') === 'true';
    expanded ? closeMenu() : openMenu();
  });
  backdrop?.addEventListener('click', closeMenu);
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeMenu(); });
  document.querySelectorAll('.mobile-submenu')?.forEach((sub) => {
    const parent = sub.previousElementSibling;
    parent?.addEventListener('click', (e) => {
      if (window.innerWidth < 1024 && sub) {
        e.preventDefault();
        sub.classList.toggle('hidden');
      }
    });
  });
</script>

